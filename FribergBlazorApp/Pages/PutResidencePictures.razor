@page "/erp/{id}"
@inject HttpClient client
@inject NavigationManager Navigation

<h3>Redigera Bild</h3>

<div>
    <label for="picture">Bild:</label>
    <input type="text" id="picture" @bind="picture.picture" />
</div>
<div>
    <label for="residenceId">Bostads ID:</label>
    <input type="number" id="residenceId" @bind="picture.ResidenceId" />
</div>
<button @onclick="UpdatePicture">Ändra</button>

<p>@returnText</p>

@code {
    Picture picture = new Picture();
    string returnText = "";

    [Parameter]
    public string? id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            picture = await client.GetFromJsonAsync<Picture>($"api/residencepictures/{id}");
        }
        catch (Exception ex)
        {
            returnText = "Felmeddelande: " + ex.Message;
        }
    }

    async Task UpdatePicture()
    {
        try
        {
            HttpResponseMessage response = await client.PutAsJsonAsync($"api/residencepictures/{id}", picture);
            if (response.IsSuccessStatusCode)
            {
                returnText = "Bild lyckades med att ändras!";
                Navigation.NavigateTo("/rp");
            }
            else
            {
                returnText = "Misslyckades med att ändra bild!: " + response.ReasonPhrase;
            }
        }
        catch (Exception ex)
        {
            returnText = "Fel: " + ex.Message;
        }
    }
}
