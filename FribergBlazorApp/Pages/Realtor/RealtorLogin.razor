@page "/login"
@using FribergBlazorApp.Models
@using FribergBlazorApp.Services
@using FribergWebAPI.DTOs
@inject AuthService authService
@inject NavigationManager navigationManager

<h3>Login</h3>

<EditForm Model="@loginModel" OnValidSubmit="HandleLogin">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <label for="email">Email</label>
    <InputText id="email" @bind-Value="loginModel.Email" />

    <label for="password">Password</label>
    <InputText id="password" @bind-Value="loginModel.Password" />

    <button type="submit">Login</button>
</EditForm>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger" role="alert">
        @errorMessage
    </div>
}

@code {
    private LoginRealtorDto loginModel = new LoginRealtorDto();
    private string errorMessage;

    private async Task HandleLogin()
    {
        try
        {
            var authResponse = await authService.Login(loginModel);

            Console.WriteLine($"Token: {authResponse.Token}");

            navigationManager.NavigateTo("/categories");
        }
        catch (Exception ex)
        {
            errorMessage = "Login failed. Please check your credentials and try again."; 
            Console.WriteLine($"Login error: {ex.Message}");
        }
    }
}
